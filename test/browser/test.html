<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="vendor/mocha.css" />
    </head>
    <body>
        <div id="mocha"></div>
        <script src="vendor/jquery-2.0.3.min.js"></script>
        <script src="vendor/underscore-min.js"></script>
        <script src="vendor/backbone-min.js"></script>
        <script src="vendor/promise-0.1.1.min.js"></script>
        <script src="js/Backbone.cruds.sync.js"></script>
        <script src="vendor/chai.js"></script>
        <script src="vendor/mocha.js"></script>
        <script>
            mocha.setup("bdd");
        </script>
        <script src="js/test.raw.js"></script>
        <script src="js/test.backbone.cruds.js"></script>
        <script>
  onload = function(){
    //mocha.checkLeaks();
    //mocha.globals(['foo']);
    var runner = mocha.run();

    var failedTests = [];
    runner.on('end', function(){
      window.mochaResults = runner.stats;
      window.mochaResults.reports = failedTests;
    });

    runner.on('fail', logFailure);

    function logFailure(test, err){

      var flattenTitles = function(test){
        var titles = [];
        while (test.parent.title){
          titles.push(test.parent.title);
          test = test.parent;
        }
        return titles.reverse();
      };

      failedTests.push({
        name: test.title,
        result: false,
        message: err.message,
        stack: err.stack,
        titles: flattenTitles(test)
      });
    };
  };
        </script>
    </body>
</html>